language: scala

sudo: required

services: docker

jdk: openjdk11

scala: 2.12.8

env:
  global:
    - secure: "bARq09zUgTg6hzUAOaRJ0ntfbpWJRjuEe4zoDRMaW9uzkGE7e0ZiYVuvcb5BCJ+sUwtzke/+vtv+JBML7tpxxMJkXkEJZGZ77PdIuFRS7+h/bD6JGZQQMC2rU9JuKSc24O1qEobQa8Pj9tIvUkxp7XZDP/fKTnHtjdMBHeErs7DWFoIEVTVdovxYZGy6fHp4sI9jo5e4VC2XIA1iMWTnACudqUvFUJ4E1Gi6F9OzhbGlICbeofeHs3PnmYdqhn5Yqx9Z2FPuxh+qewadUMK2jg1dxUmHfuxfCyvrvhDMmPxrUbThZKSrGiULVoRLCPR9h5VHHhOzm28FRZRnCLqr8d1RsCHiLeeGPm7W7wv4sx7y9ir76s3tsrASwMxRTy/d0CDAZQUjI9ScYp2dIknz/OByLSzeeMrMUvKmOR1ubN/sPoxS7odls/IGQ/TDhkbOC49X9nho5y84pl7MHg1tBcdek/rT/itEEWZwj4jQ6s8lZUqgqwpPpLw0JOv782FDV73BbOc6ufH9TjtapB5PhiVnCV9tzGnGoDSSB0cgAe+6KR3vkCOvixh1adWJt3GQfsjrobqp/CWoOC19C0kUo4sweDovnT055/k1oFzvdBLYpuhXmYx/4yolBJzOIGdz/KY4meyIRa2VmR9s9RecOv4GSIjCH8jK7wRDcqxDfGI="
    - secure: "fT0m0RGg7Sb4ZhdpzCovzH/T9zwzH4/McawT3ABdGXoEnHHWj4hrQElbK69W7cXznWPW/6vTRXCG3nxVIpvPa5edBRMf0iXXZMs/AZiiPZKmOQPm5dVFznBczPfWen9iNbR19UJIM0QE76XGL8RZOGkmmQzD43S5heQGaMKmlrkRXcj8ehp6dpbR9javelgLqesiyuzu7jPPOJCodTLQKGcB2bSscz2pS+0+oAqDD2NJ6JGhI/5j4QXwvBpAwWqzpF5SgecnxgsDiAY3Zcc7lD3qY67WUw6oDs8HPa4hg0OlEnGz2qvswfoM4jaAQ0F7Az6AftxRksu11uMxQIBdEgZxkdn0C/I5CO8GexPs/ChSsqituqouzUJscdh74hCFZQ38g3rtgrzhl2dZbGsTJpHlNxgYw7cAaT2eGvbZUGemruOcke0dY4KZzYIwiFYAKejOG6DXRtFVtJBEGFno10R+vPH2CSPFE08Mx7MgKHiLxqckk/qnpTsUSpUF9JPM5zJmUqx5T/cEBIHxDnLMdcVtByiTSwLl4irvLub+319cSmMjpHuYA+qVvhubkOtLT+D097vj9WpODsZ7jSfLqLket5nwrM+cCrxLhYXqHahAvZMAuKEiDMzxwvnRozjPsblNfXJe5gBVvQIyMZc6+yQ4KDwgZqzYp1dnhObn0V8="

cache:
  directories:
    - $HOME/.coursier
    - $HOME/.ivy2/cache
    - $HOME/.sbt

before_cache:
  - find $HOME/.ivy2/cache -name "ivydata-*.properties" -delete
  - find $HOME/.sbt        -name "*.lock"               -delete

notifications:
  email:
    on_success: never

before_script:
  - sbt -J-Dsbt.log.noformat=true dependencyTree | PROJECT_GROUP_KEY=godfather YAMORY_API_KEY="${YAMORY_API_KEY}" bash -c "$(curl -sSf -L https://localscanner.yamory.io/script/sbt)"
  - echo ${DOCKERHUB_PASSWORD} | docker login -u cndjpintegrate --password-stdin
script:
  - sbt test
  - sbt assembly
  - docker build -t cndjp/godfather:$(git rev-parse HEAD) .
  - if [[ "${TRAVIS_BRANCH}" = "master" ]]; then docker push cndjp/godfather:$(git rev-parse HEAD); fi